<!DOCTYPE html>

<html><head>
    <th:block th:replace="~{head :: common_head}" />
    <th:block th:replace="~{jquery}" />
    <th:block th:replace="~{table}" />
    <script type="text/javascript" th:src="@{/script/jquery.fancyzoom.js}"></script>
    <script type="text/javascript" th:src="@{/script/utils.js}"></script>
    <style>
        #topSongsHeader, #filesHeader, #subDirsHeader {
            display: inline-block;
            border: dotted;
            border-width: thin;
            padding: 0.25em 1em 0.25em 1em;
        }
        .headerNotSelected, .starSong, .playSong, .addSongNext, .addSongLast {
            cursor: pointer;
        }
        #subDirsTable_wrapper {
            flex-grow: 1;
            flex-shrink: 1;
        }
        .duration {
            position: absolute;
            bottom: 3px;
            right: 3px;
            color: #d3d3d3;
            background-color: black;
            opacity: 0.8;
            padding-right:3px;
            padding-left:3px;
        }
        #ancestors {
            margin-bottom: 0.1em;
        }
        #ancestors svg, #mediaDirTitle svg{
            margin-right: 0.2em;
            vertical-align: text-top;
        }
        #mediaDirController {
            margin-top: 0.8em;
            padding: 0.5em 0;
            border-top: 1px solid gray;
        }
        #mediaDirTitle {
            font-size: 150%;
            padding: 0;
            border: 0;
            margin: 0;
        } 
        #mediaDirController span {
            margin-right: 0.3em;
        }
        #avgRating {
            height: 20px;
            margin-top: 0.5em;
        }
    </style>
<script type="text/javascript" th:inline="javascript"
        th:with="paginationaddition=${#strings.contains(' 10 20 50 100 -1', ' '.concat(model['initialPaginationSizeFiles'] ?: '') ) ?
                            '' : ', '.concat(model['initialPaginationSizeFiles'] ?: '')},
                paginationadditionFolders=${#strings.contains(' 10 20 50 100 -1', ' '.concat(model['initialPaginationSizeFolders'] ?: '') ) ?
                            '' : ', '.concat(model['initialPaginationSizeFolders'] ?: '')}">
    var mediaDir = {files: [], subDirs: []};
    var filesTable = null;
    var subDirsTable = null;
    var subDirsTableData = [];
    var thumbsData = [];
    var viewAsList = /*[[${model.viewAsList == true}]]*/ false;
    var topSongs = [];
    var artistTopSongsTable = null;
    var initialIds = /*[[(${model.initialIds})]]*/ [];
    var initialPaths = /*[[(${model.initialPaths})]]*/ {};

    function getMediaDirectory(mediaFileId) {
        getMediaDirectories([mediaFileId]);
    }

    function getMediaDirectories(ids, paths) {
        console.log('getting dirs', JSON.stringify({ids: ids, paths: paths}))
        top.StompClient.send("/app/mediafile/directory/get", JSON.stringify({ids: ids, paths: paths}));
    }

    function getMediaDirectoryCallback(mediaDirObj) {
        if (mediaDirObj.contentType == 'notFound') {
            window.location = 'notFound';
            return;
        }
        if (mediaDirObj.contentType == 'home') {
            window.location = 'home';
            return;
        }
        if (mediaDirObj.contentType == 'accessDenied') {
            window.location = 'accessDenied';
            return;
        }

        mediaDir = mediaDirObj;

        if (!mediaDir.subDirs) {
            mediaDir.subDirs = [];
        }
        if (!mediaDir.siblingAlbums) {
            mediaDir.siblingAlbums = [];
        }

        generateMediaDirThumb();
        refreshViewDependentComponents();

        let showArtistInfo = /*[[${model.showArtistInfo}]]*/ false;
        if(showArtistInfo) { loadArtistInfo(); }

        // directory star
        updateStarImage();

        // ancestors
        populateAncestors();

        // media dir title
        populateMediaDirTitle();

        // comments
        updateComments();

        // search components
        if (mediaDir.album == null && mediaDir.artist == null) {
            $('.external-search').hide();
        } else {
            $('.external-search').show();
        }

        if (mediaDir.musicBrainzReleaseId == null) {
            $('.external-search.musicbrainz').hide();
        } else {
            $('.external-search.musicbrainz').show();
        }

        updatePlayCountData();

        getRatings();

        if (mediaDir.contentType == 'artist') {
            populateArtistImage();
        }
    }

    function populateArtistImage() {
        var covertArtUrlBase = '[(@{/coverArt})]';
        $("#artistImage").attr({
            "src": covertArtUrlBase + '?size=[(${model.coverArtSizeLarge})]&id=' + mediaDir.id,
            "class": "fancy"
        });
    }

    function refreshViewDependentComponents() {
        // show only appropriate components
        $(".pagetype-dependent:not(.type-" + mediaDir.contentType + ")").hide();
        $(".pagetype-dependent.type-" + mediaDir.contentType).show();
        $('#subDirsTable_wrapper').show();

        if (mediaDir.contentType == 'artist') {
            $('#filesTable_wrapper').hide();
            $('#artistInfoTable').addClass('bgcolor2 dropshadow');
        } else {
             $('#artistInfoTable').removeClass('bgcolor2 dropshadow');
             $('#filesTable_wrapper').show();
        }

        // mix subdirectories and siblings, not an issue for non-albums because sibs are always empty
        subDirsTableData = mediaDir.subDirs.concat(mediaDir.siblingAlbums);

        // separate albums and non-albums if not list view
        thumbsData = [];
        if (!viewAsList) {
            thumbsData = subDirsTableData.filter(x => x.entryType == 'ALBUM');
            subDirsTableData = subDirsTableData.filter(x => x.entryType != 'ALBUM');

            if (mediaDir.contentType == 'video') {
                thumbsData = thumbsData.concat(mediaDir.files);
                $('#filesTable_wrapper, #moreActions').hide();
            }
        }

        if (mediaDir.files.length == 0) {
            $('#filesTable_wrapper, #moreActions').hide();
        }

        if (subDirsTableData.length == 0) {
            $('#subDirsTable_wrapper').hide();
        }

        // subdirs heading
        subDirsHeading();

        filesTable.ajax.reload().columns.adjust();
        subDirsTable.ajax.reload().columns.adjust();

        generateThumbs();
    }

    function generateMediaDirThumb() {
        var urlBase = '[(@{/coverArtJsp})]';
        $.get(urlBase + '?coverArtSize=[(${model.coverArtSizeLarge})]&showZoom=true&showChange=[(${model.user.coverArtRole})]&albumId=' + mediaDir.id, data => {
            $('#mediaDirThumb').html(data);
        });
    }

    function generateThumbs() {
        var urlBase = '[(@{/coverArtJsp})]';
        $('#thumbs').html('');

        thumbsData.filter(t => t.entryType != 'VIDEO').forEach((t,i) => {
            //append container first to keep order intact when async callback happens
            $('#thumbs').append('<div class="albumThumb"></div>');
            $.get(urlBase + '?hideOverflow=true&showLink=true&appearAfter=' + (i * 30) + '&coverArtSize=[(${model.coverArtSizeMedium})]&captionCount=2&caption2=' + (t.year ? t.year : '') + '&caption1=' + encodeURIComponent(t.title) +'&albumId=' + t.id, data => {
                $('#thumbs .albumThumb:nth-child(' + (i + 1) + ')').append(data);
            });
        });

        var videoUrlBase = '[(@{/videoPlayer})]';
        var covertArtUrlBase = '[(@{/coverArt})]';
        thumbsData.filter(t => t.entryType == 'VIDEO').forEach(t => {
            var vidUrl = videoUrlBase + '?id=' + t.id;
            var vid = '' +
            '<div class="albumThumb">' +
              '<div class="coverart dropshadow" style="width:213px">' +
                '<div style="position:relative">' +
                  '<div>' +
                    '<a href="' + vidUrl + '">' +
                      '<img src="' + covertArtUrlBase + '?size=120&id=' + t.id + '" height="120" width="213" alt="" onmouseover="startPreview(this, ' + t.id + ', ' + t.duration + ')" onmouseout="stopPreview()" />' +
                    '</a>' +
                  '</div>' +
                  '<div class="detail duration">' + t.durationString + '</div>' +
                '</div>' +
                $('<div>').addClass('caption1').attr('title', t.title).append(
                  $('<a>').attr('href', vidUrl).attr('title', t.title).text(t.title))[0].outerHTML +
              '</div>' +
            '</div>';

            $('#thumbs').append(vid);
        });
    }

    function getRatings() {
        var urlBase = '[(@{/ratingJsp})]';
        if (mediaDir.averageRating && mediaDir.averageRating > 0) {
            $.get(urlBase + '?readOnly=true&rating=' + mediaDir.averageRating, data => {
                $('#avgRating').html(data);
                $('#avgRating').prepend(feather.icons.users.toSvg({class: 'feather-sm'})).show();
            });
        } else {
            $('#avgRating').html('').hide();
        }

        $.get(urlBase + '?readOnly=false&id=' + mediaDir.id + '&rating=' + mediaDir.userRating, data => {
            $('#userRating').html(data);
        });
    }

    function updatePlayCountData() {
        var playcount = '';
        if (mediaDir.playCount) {
            playcount += '[(#{main.playcount(${"%v%"})})]'.replace('%v%', mediaDir.playCount);
        }
        if (mediaDir.lastPlayed) {
            playcount += '[(#{main.lastplayed(${"%v%"})})]'.replace('%v%', new Date(mediaDir.lastPlayed));
        }
        $('#playCountData').text(playcount);
    }

    function updateComments() {
        $('#comment').text(mediaDir.comment);
        $('#commentForm textarea').text(mediaDir.comment);
        $('#commentForm input[name="id"]').val(mediaDir.id);
    }

    function subDirsHeading() {
        var subDirHeading = 'Subdirectories';

        if (mediaDir.contentType == 'album' && viewAsList) {
            subDirHeading = 'Subdirectories and Sibling Albums';
        }
        $("#subDirsHeader").html("<h2 style='margin: 0'>" + subDirHeading + "</h2>");
    }

    function init() {
        $("a.fancy").fancyZoom({
            minBorder: 30
        });

        var dialogSize = getJQueryUiDialogPlaylistSize("mediaMain");
        $("#dialog-select-playlist").dialog({resizable: true, height: dialogSize.height, width: dialogSize.width, autoOpen: false,
            buttons: {
                '[(#{common.add})]' : function() {
                    appendPlaylists();
                },
                '[(#{common.cancel})]' : function() {
                    $(this).dialog("close");
                }
            },
            resizeStop: function (event, ui) { setJQueryUiDialogPlaylistSize("mediaMain", ui.size) }
        });

        var ratingOnImage = /*[[${#themes.code('ratingOnImage')}]]*/ "icons\/default\/ratingOn.svg";
        var ratingOffImage = /*[[${#themes.code('ratingOffImage')}]]*/ "icons\/default\/ratingOff.svg";

        /** FILES **/
        filesTable = $("#filesTable").DataTable( {
            deferRender: true,
            createdRow(row, data, dataIndex, cells) {
                var rowNode = $(row);
                if (rowNode.hasClass("selected")) {
                    rowNode.find(".songIndex input").prop("checked", true);
                }
            },
            colReorder: true,
            stateSave: true,
            stateDuration: 60 * 60 * 24 * 365,
            ordering: true,
            order: [],
            //orderFixed: [ 0, 'asc' ],
            orderMulti: true,
            pageLength: /*[[${model.initialPaginationSizeFiles}]]*/ 10,
            /*[+
            lengthMenu: [ 
                [10, 20, 50, 100, -1 [(${paginationaddition})] ], 
                [10, 20, 50, 100, "All" [(${paginationaddition})] ] 
            ],
            +]*/
            /*[- */
            lengthMenu: [ 
                [10, 20, 50, 100, -1], 
                [10, 20, 50, 100, "All"] 
            ],
            /* -]*/
            processing: true,
            autoWidth: true,
            scrollCollapse: true,
            dom: "<'#filesHeader'><'tableSpacer'>lfrtip",
            select: {
                style: "multi",
                selector: ".songIndex"
            },
            ajax: function(ajaxData, callback) {
                console.log('ajax', ajaxData)
                for ( var i=0, len=mediaDir.files.length ; i<len ; i++ ) {
                  mediaDir.files[i].seq = i;
                }
                callback({data: mediaDir.files});
            },
            stripeClasses: ["bgcolor2", "bgcolor1"],
            columnDefs: [{ targets: "_all", orderable: true }],
            columns: [
                { data: "seq", className: "detail fit", visible: true },
                { data: "starred",
                  name: "starred",
                  className: "fit not-draggable centeralign",
                  render: function(starred, type) {
                      if (type == "display") {
                          return "<img class='starSong' src='" + (starred ? ratingOnImage : ratingOffImage) + "' style='height:18px;' alt='' title=''>";
                      }
                      return starred ? "onlystarred" : "unstarred";
                  }
                },
                { data: null,
                  searchable: false,
                  name: "play",
                  visible: /*[[${model.user.streamRole and !model.partyMode}]]*/ true,
                  className: "fit not-draggable centeralign",
                  defaultContent: "<img class='playSong' src=\"[(${#themes.code('playImage')})]\" style='height:18px;' alt=\"[(#{common.play})]\" title=\"[(#{common.play})]\">"
                },
                { data: "entryType",
                  searchable: false,
                  name: "addLast",
                  visible: /*[[${model.user.streamRole and !model.partyMode}]]*/ true,
                  className: "fit not-draggable centeralign",
                  render: function(entryType, type, row) {
                      if (type == "display" && entryType != "VIDEO" && entryType != "DIRECTORY" && entryType != "ALBUM") {
                          return "<img class='addSongLast' src=\"[(${#themes.code('addImage')})]\" style='height:18px;' alt=\"[(#{common.add})]\" title=\"[(#{common.add})]\">";
                      }
                      return "";
                  }
                },
                { data: "entryType",
                  searchable: false,
                  name: "addNext",
                  visible: /*[[${model.user.streamRole and !model.partyMode}]]*/ true,
                  className: "fit not-draggable centeralign",
                  render: function(entryType, type, row) {
                      if (type == "display" && entryType != "VIDEO" && entryType != "DIRECTORY" && entryType != "ALBUM") {
                          return "<img class='addSongNext' src=\"[(${#themes.code('addNextImage')})]\" style='height:18px;' alt=\"[(#{main.addnext})]\" title=\"[(#{main.addnext})]\">";
                      }
                      return "";
                  }
                },
                { data: null,
                  searchable: false,
                  name: "songcheckbox",
                  className: "fit not-draggable songIndex centeralign",
                  defaultContent: "<input type='checkbox'>"
                },
                { data: "trackNumber", className: "detail fit", visible: /*[[${model.visibility.trackNumberVisible}]]*/ true, title: /*[[#{personalsettings.tracknumber}]]*/ "track" },
                { data: "discNumber", className: "detail fit", visible: /*[[${model.visibility.discNumberVisible}]]*/ true, title: /*[[#{personalsettings.discnumber}]]*/ "disc" },
                { data: "title",
                  className: "detail songTitle truncate",
                  title: /*[[#{edittags.songtitle}]]*/ "title",
                  render: function(title, type, row) {
                      if (type == "display" && title != null) {
                          return $("<span>", {title: title, alt: title, text: title})[0].outerHTML;
                      }
                      return title;
                  }
                },
                { data: "album",
                  className: "detail truncate",
                  visible: /*[[${model.visibility.albumVisible}]]*/ true,
                  title: /*[[#{personalsettings.album}]]*/ "album",
                  render: function(album, type, row) {
                      if (type == "display" && album != null) {
                          return $("<span>", {title: album, alt: album, text: album})[0].outerHTML;
                      }
                      return album;
                  }
                },
                { data: "artist",
                  className: "detail truncate",
                  visible: /*[[${model.visibility.artistVisible}]]*/ false,
                  title: /*[[#{personalsettings.artist}]]*/ "artist",
                  render: function(artist, type) {
                      if (type == "display" && artist != null) {
                          return $("<span>", {title: artist, alt: artist, text: artist})[0].outerHTML;
                      }
                      return artist;
                  }
                },
                { data: "albumArtist",
                  className: "detail truncate",
                  visible: /*[[${model.visibility.albumArtistVisible}]]*/ false,
                  title: /*[[#{personalsettings.albumartist}]]*/ "AlbumArtist",
                  render: function(artist, type) {
                      if (type == "display" && artist != null) {
                          return $("<span>", {title: artist, alt: artist, text: artist})[0].outerHTML;
                      }
                      return artist;
                  }
                },
                { data: "genre",
                  className: "detail truncate",
                  visible: /*[[${model.visibility.genreVisible}]]*/ true,
                  title: /*[[#{personalsettings.genre}]]*/ "genre",
                  render: function(genre, type) {
                      if (type == "display" && genre != null) {
                          return $("<span>", {title: genre, alt: genre, text: genre})[0].outerHTML;
                      }
                      return genre;
                  }
                },
                { data: "year", className: "detail fit rightalign", visible: /*[[${model.visibility.yearVisible}]]*/ true, title: /*[[#{personalsettings.year}]]*/ "year" },
                { data: "format", className: "detail fit rightalign", visible: /*[[${model.visibility.formatVisible}]]*/ true, title: /*[[#{personalsettings.format}]]*/ "format" },
                { data: "fileSize", className: "detail fit rightalign", visible: /*[[${model.visibility.fileSizeVisible}]]*/ true, title: /*[[#{personalsettings.filesize}]]*/ "size" },
                { data: "duration",
                  className: "detail fit rightalign",
                  visible: /*[[${model.visibility.durationVisible}]]*/ false,
                  title: /*[[#{personalsettings.duration}]]*/ "duration",
                  render: function(data, type, row) {
                      if (type == "display" && data != null) {
                          return formatDuration(Math.round(data));
                      }
                      return data;
                  }
                },
                { data: "bitRate", className: "detail fit rightalign", visible: /*[[${model.visibility.bitRateVisible}]]*/ true, title: /*[[#{personalsettings.bitrate}]]*/ "bitrate" },
            { data: "playCount", className: "detail fit rightalign", visible: /*[[${model.visibility.playCountVisible}]]*/ true, title: /*[[#{personalsettings.playcount}]]*/ "playcount" },
                { data: "lastPlayed",
                  className: "detail fit rightalign",
                  visible: /*[[${model.visibility.lastPlayedVisible}]]*/ false,
                  title: /*[[#{personalsettings.lastplayed}]]*/ "lastplayed",
                  render: function(data, type, row) {
                      if (data != null) {
                          if (type == "display") {
                              return new Date(data).toLocaleString();
                          }
                          return new Date(data).getTime();
                      }
                      return data;
                  }
                },
                { data: "lastScanned",
                  className: "detail fit rightalign",
                  visible: /*[[${model.visibility.lastScannedVisible}]]*/ true,
                  title: /*[[#{personalsettings.lastscanned}]]*/ "lastscanned",
                  render: function(data, type, row) {
                      if (data != null) {
                          if (type == "display") {
                              return new Date(data).toLocaleString();
                          }
                          return new Date(data).getTime();
                      }
                      return data;
                  }
                },
                { data: "created",
                  className: "detail fit rightalign",
                  visible: /*[[${model.visibility.createdVisible}]]*/ false,
                  title: /*[[#{personalsettings.created}]]*/ "created",
                  render: function(data, type, row) {
                      if (data != null) {
                          if (type == "display") {
                              return new Date(data).toLocaleString();
                          }
                          return new Date(data).getTime();
                      }
                      return data;
                  }
                },
                { data: "changed",
                  className: "detail fit rightalign",
                  visible: /*[[${model.visibility.changedVisible}]]*/ false,
                  title: /*[[#{personalsettings.changed}]]*/ "changed",
                  render: function(data, type, row) {
                      if (data != null) {
                          if (type == "display") {
                              return new Date(data).toLocaleString();
                          }
                          return new Date(data).getTime();
                      }
                      return data;
                  }
                },
                { data: "entryType",
                  className: "detail fit rightalign truncate",
                  visible: /*[[${model.visibility.entryTypeVisible}]]*/ true,
                  title: /*[[#{personalsettings.entrytype}]]*/ "entrytype",
                  render: function(entryType, type, row) {
                      if (type == "display" && entryType != null) {
                          var media = entryType.toLowerCase();
                          if (entryType == 'VIDEO') {
                              media += " " + row.dimensions
                          }
                          return $("<span>", {title: media, alt: media, text: media})[0].outerHTML;
                      }
                      return entryType;
                  }
                }
            ]
        } );

        filesTable.on( 'select', function ( e, dt, type, indexes ) {
             filesTable.cells( indexes, "songcheckbox:name" ).nodes().to$().find("input").prop("checked", true);
        } );
        filesTable.on( 'deselect', function ( e, dt, type, indexes ) {
             filesTable.cells( indexes, "songcheckbox:name" ).nodes().to$().find("input").prop("checked", false);
        } );
        $("#filesTable tbody").on( "click", ".starSong", function () {
            onToggleStar(filesTable.row( $(this).parents('tr') ));
        } );
        $("#filesTable tbody").on( "click", ".playSong", function () {
            onPlay(filesTable.row( $(this).parents('tr') ));
        } );
        $("#filesTable tbody").on( "click", ".addSongLast", function () {
            onAdd(filesTable.row( $(this).parents('tr') ));
        } );
        $("#filesTable tbody").on( "click", ".addSongNext", function () {
            onAddNext(filesTable.row( $(this).parents('tr') ));
        } );

        $("#filesHeader").html("<h2 style='margin: 0'>Files</h2>");

        /** SUBDIRS **/
        subDirsTable = $("#subDirsTable").DataTable( {
            deferRender: true,
            colReorder: true,
            stateSave: true,
            stateDuration: 60 * 60 * 24 * 365,
            ordering: true,
            order: [],
            orderFixed: [ 0, 'asc' ],
            orderMulti: false,
            pageLength: /*[[${model.initialPaginationSizeFolders}]]*/ 10,
            /*[+
            lengthMenu: [ 
                [10, 20, 50, 100, -1 [(${paginationadditionFolders})] ], 
                [10, 20, 50, 100, "All" [(${paginationadditionFolders})] ] 
            ],
            +]*/
            /*[- */
            lengthMenu: [ 
                [10, 20, 50, 100, -1], 
                [10, 20, 50, 100, "All"] 
            ],
            /* -]*/
            processing: true,
            autoWidth: true,
            scrollCollapse: true,
            //scrollY: "60vh",
            dom: "<'#subDirsHeader'><'tableSpacer'>lfrtip",
            ajax: function(ajaxData, callback) {
                for ( var i=0, len=subDirsTableData.length ; i<len ; i++ ) {
                    subDirsTableData[i].seq = i;
                }
                callback({data: subDirsTableData});
            },
            stripeClasses: ["bgcolor2", "bgcolor1"],
            columnDefs: [{ targets: "_all", orderable: false }],
            columns: [
                { data: "seq", className: "detail fit", visible: true },
                { data: null,
                  searchable: false,
                  name: "play",
                  visible: /*[[${model.user.streamRole and !model.partyMode}]]*/ true,
                  className: "fit not-draggable centeralign",
                  defaultContent: "<img class='playSong' src=\"[(${#themes.code('playImage')})]\" style='height:18px;' alt=\"[(#{common.play})]\" title=\"[(#{common.play})]\">"
                },
                { data: "entryType",
                  searchable: false,
                  name: "addLast",
                  visible: /*[[${model.user.streamRole and !model.partyMode}]]*/ true,
                  className: "fit not-draggable centeralign",
                  render: function(entryType, type, row) {
                      if (type == "display") {
                          return "<img class='addSongLast' src=\"[(${#themes.code('addImage')})]\" style='height:18px;' alt=\"[(#{common.add})]\" title=\"[(#{common.add})]\">";
                      }
                      return "";
                  }
                },
                { data: "entryType",
                  searchable: false,
                  name: "addNext",
                  visible: /*[[${model.user.streamRole and !model.partyMode}]]*/ true,
                  className: "fit not-draggable centeralign",
                  render: function(entryType, type, row) {
                      if (type == "display") {
                          return "<img class='addSongNext' src=\"[(${#themes.code('addNextImage')})]\" style='height:18px;' alt=\"[(#{main.addnext})]\" title=\"[(#{main.addnext})]\">";
                      }
                      return "";
                  }
                },
                { data: "title",
                  className: "detail songTitle truncate",
                  render: function(title, type, row) {
                      if (type == "display" && title != null) {
                          return $("<a>", {title: title, alt: title, text: title, href: "#"})[0].outerHTML;
                      }
                      return title;
                  }
                },
                { data: "year", className: "detail fit rightalign" }
            ]
        } );

        $("#subDirsTable tbody").on( "click", ".songTitle a", function () {
            getMediaDirectory(subDirsTable.row( $(this).parents('tr') ).data().id);
        } );
        $("#subDirsTable tbody").on( "click", ".playSong", function () {
            onPlay(subDirsTable.row( $(this).parents('tr') ));
        } );
        $("#subDirsTable tbody").on( "click", ".addSongLast", function () {
            onAdd(subDirsTable.row( $(this).parents('tr') ));
        } );
        $("#subDirsTable tbody").on( "click", ".addSongNext", function () {
            onAddNext(subDirsTable.row( $(this).parents('tr') ));
        } );

        /** ARTIST TOP SONGS **/
        artistTopSongsTable = $("#artistTopSongsTable").DataTable( {
            deferRender: true,
            colReorder: true,
            stateSave: true,
            stateDuration: 60 * 60 * 24 * 365,
            ordering: true,
            order: [],
            orderFixed: [ 0, 'asc' ],
            orderMulti: false,
            pageLength: /*[[${model.initialPaginationSizeFolders}]]*/ 10,
            /*[+
            lengthMenu: [ 
                [10, 20, 50, 100, -1 [(${paginationadditionFolders})] ], 
                [10, 20, 50, 100, "All" [(${paginationadditionFolders})] ] 
            ],
            +]*/
            /*[- */
            lengthMenu: [ 
                [10, 20, 50, 100, -1], 
                [10, 20, 50, 100, "All"] 
            ],
            /* -]*/
            processing: true,
            autoWidth: true,
            scrollCollapse: true,
            scrollY: "60vh",
            dom: "<'#topSongsHeader'><'tableSpacer'>lfrtip",
            ajax: function(ajaxData, callback) {
                for ( var i=0, len=topSongs.length ; i<len ; i++ ) {
                  topSongs[i].seq = i;
                }
                callback({data: topSongs});
            },
            stripeClasses: ["bgcolor2", "bgcolor1"],
            columnDefs: [{ targets: "_all", orderable: false }],
            columns: [
                { data: "seq", className: "detail fit", visible: true },
                { data: "starred",
                  name: "starred",
                  className: "fit not-draggable centeralign",
                  render: function(starred, type) {
                      if (type == "display") {
                          return "<img class='starSong' src='" + (starred ? ratingOnImage : ratingOffImage) + "' style='height:18px;' alt='' title=''>";
                      }
                      return starred ? "onlystarred" : "unstarred";
                  }
                },
                { data: null,
                  searchable: false,
                  name: "play",
                  className: "fit not-draggable centeralign",
                  defaultContent: "<img class='playSong' src=\"[(${#themes.code('playImage')})]\" style='height:18px;' alt=\"[(#{common.play})]\" title=\"[(#{common.play})]\">"
                },
                { data: null,
                  searchable: false,
                  name: "addLast",
                  className: "fit not-draggable centeralign",
                  defaultContent: "<img class='addSongLast' src=\"[(${#themes.code('addImage')})]\" style='height:18px;' alt=\"[(#{common.add})]\" title=\"[(#{common.add})]\">"
                },
                { data: null,
                  searchable: false,
                  name: "addNext",
                  className: "fit not-draggable centeralign",
                  defaultContent: "<img class='addSongNext' src=\"[(${#themes.code('addNextImage')})]\" style='height:18px;' alt=\"[(#{main.addnext})]\" title=\"[(#{main.addnext})]\">"
                },
                { data: "title",
                  className: "detail songTitle truncate",
                  render: function(title, type, row) {
                      if (type == "display" && title != null) {
                          return $("<span>", {title: title, alt: title, text: title})[0].outerHTML;
                      }
                      return title;
                  }
                },
                { data: "album",
                  className: "detail truncate",
                  render: function(album, type, row) {
                      if (type == "display" && album != null) {
                          return $("<a>", {title: album, alt: album, text: album, target: "main"}).attr("href", "main?id=" + row.id)[0].outerHTML;
                      }
                      return album;
                  }
                },
                { data: "artist",
                  className: "detail truncate",
                  render: function(artist, type, row) {
                      if (type == "display" && artist != null) {
                          return $("<span>", {title: artist, alt: artist, text: artist})[0].outerHTML;
                      }
                      return artist;
                  }
                },
                { data: "duration",
                  className: "detail fit rightalign",
                  render: function(data, type, row) {
                      if (type == "display" && data != null) {
                          return formatDuration(Math.round(data));
                      }
                      return data;
                  }
                }
            ]
        } );

        $("#artistTopSongsTable tbody").on( "click", ".starSong", function () {
            onToggleStar(artistTopSongsTable.row( $(this).parents('tr') ));
        } );
        $("#artistTopSongsTable tbody").on( "click", ".playSong", function () {
            playTopSong(artistTopSongsTable.row( $(this).parents('tr') ).index());
        } );
        $("#artistTopSongsTable tbody").on( "click", ".addSongLast", function () {
            onAdd(artistTopSongsTable.row( $(this).parents('tr') ));
        } );
        $("#artistTopSongsTable tbody").on( "click", ".addSongNext", function () {
            onAddNext(artistTopSongsTable.row( $(this).parents('tr') ));
        } );

        $("#topSongsHeader").html("<h2>[(#{main.topsongs})]</h2>");
        $("#artistTopSongsTable_wrapper").hide();

        viewSelectorRefresh();
        let subs = {
            '/user/queue/mediafile/directory/get': function(msg) {
                getMediaDirectoryCallback(JSON.parse(msg.body));
            },
            '/user/queue/playlists/writable': function(msg) {
                playlistSelectionCallback(JSON.parse(msg.body));
            },
            '/user/queue/playlists/files/append': function(msg) {
                $().toastmessage("showSuccessToast", /*[[#{playlist.toast.appendtoplaylist}]]*/ null);
            },
            "/user/queue/settings/viewAsList": function(msg) {
                viewChangedCallback(JSON.parse(msg.body));
            }
        }
        let showArtistInfo = /*[[${model.showArtistInfo}]]*/ true;
        if(showArtistInfo) {
           subs["/user/queue/artist/info"] = function(msg) {
               loadArtistInfoCallback(JSON.parse(msg.body));
           }
        }

        top.StompClient.subscribe("mediaMain.html", subs, function() {
            if (initialIds.length != 0 || initialPaths.length != 0) {
                getMediaDirectories(initialIds, initialPaths);
            }
        });

        feather.replace();
        <!-- add title to feather icons-->
        Array.from(document.querySelectorAll('svg.feather[title]')).forEach((element) => {
           element.insertAdjacentHTML('afterbegin', `<title>${element.attributes.title.value}</title>`);
        });
    }

    function loadArtistInfo() {
        top.StompClient.send("/app/artist/info", JSON.stringify({mediaFileId: mediaDir.id, maxSimilarArtists: 8, maxTopSongs: 100}));
    }

    function loadArtistInfoCallback(artistInfo) {
        $('#artistTitle h2').text(mediaDir.title);
        if (artistInfo.similarArtists.length > 0) {
            var html = "";
            for (var i = 0; i < artistInfo.similarArtists.length; i++) {
                html += $('<a>').attr('href', '#').attr('onclick', 'getMediaDirectory(' + artistInfo.similarArtists[i].mediaFileId + ')').text(artistInfo.similarArtists[i].artistName)[0].outerHTML;

                if (i < artistInfo.similarArtists.length - 1) {
                    html += " <span class='similar-artist-divider'>|</span> ";
                }
            }
            $("#similarArtists").html(html);
        } else {
            $('#similarArtistsContainer').hide();
        }

        if (artistInfo.artistBio && artistInfo.artistBio.biography) {
            $("#artistBio").html(artistInfo.artistBio.biography);
        }

        this.topSongs = artistInfo.topSongs;

        if (topSongs.length > 0 && mediaDir.contentType == 'artist') {
            $("#artistTopSongsTable_wrapper").show();
            $("#playTopSongs").show();
        } else {
            $("#playTopSongs").hide();
            $("#artistTopSongsTable_wrapper").hide();
        }

        artistTopSongsTable.ajax.reload().columns.adjust();

    }

    function populateAncestors() {
        var ancestors = $("#ancestors").empty();
        for (var len = mediaDir.ancestors.length, i = len - 1; i >= 0; i--) {
            var ancestor = mediaDir.ancestors[i];
            ancestors.append(feather.icons.folder.toSvg({class: 'feather-sm'}));
            ancestors.append($("<a>").attr("href", "#").attr("onclick", "getMediaDirectory(" + ancestor.id + ")").text(ancestor.title));
            ancestors.append(" » ");
        }
    }

    function populateMediaDirTitle() {
        $("#mediaDirTitle").empty();
        if (mediaDir.contentType == 'album') {
            $("#mediaDirTitle").append(feather.icons.disc.toSvg());
        } else {
            $("#mediaDirTitle").append(feather.icons.folder.toSvg());
        }
        $("#mediaDirTitle").append(mediaDir.title);
    }

    function toggleMediaDirStar(status) {
        if (mediaDir.starred != status) {
            mediaDir.starred = status;
            if (mediaDir.starred) {
                top.StompClient.send("/app/rate/mediafile/star", JSON.stringify([mediaDir.id]));
            } else {
                top.StompClient.send("/app/rate/mediafile/unstar", JSON.stringify([mediaDir.id]));
            }

            updateStarImage();
        }
    }

    function updateStarImage() {
        if (mediaDir.starred) {
            const svgTitle = /*[[#{playlist.more.unstar}]]*/ "Unstar";
            $("#starMediaDir").empty().append(feather.icons.star.toSvg({class: 'feather-filled', title: svgTitle}));
        } else {
            const svgTitle = /*[[#{playlist.more.star}]]*/ "Star";
            $("#starMediaDir").empty().append(feather.icons.star.toSvg({title: svgTitle}));
        }
        Array.from(document.querySelectorAll('#starMediaDir svg.feather[title]')).forEach((element) => {
           element.insertAdjacentHTML('afterbegin', `<title>${element.attributes.title.value}</title>`);
        });
    }

    function onStar(table, indices, status) {
        var ids = table.rows(indices).data().map(data => {
            data.starred = status;
            table.cell(data.seq, "starred:name").invalidate();
            return data.id;
        }).toArray();

        if (status) {
            top.StompClient.send("/app/rate/mediafile/star", JSON.stringify(ids));
        } else {
            top.StompClient.send("/app/rate/mediafile/unstar", JSON.stringify(ids));
        }
    }
    function onToggleStar(row) {
        onStar(row.table(), [row.data().seq], !row.data().starred);
    }
    function onPlay(row) {
        var data = row.data();
        if (data.entryType == 'VIDEO') {
            var urlBase = /*[[@{/videoPlayer}]]*/ '/videoPlayer';
            var url = urlBase + "?id=" + data.id;
            top.main.location = url;
        } else {
            top.playQueue.onPlay(data.id);
        }
    }
    function onAdd(row) {
        top.playQueue.onAdd(row.data().id);
        $().toastmessage('showSuccessToast', /*[[#{main.addlast.toast}]]*/ null)
    }
    function onAddNext(row) {
        top.playQueue.onAddNext(row.data().id);
        $().toastmessage('showSuccessToast', /*[[#{main.addnext.toast}]]*/ null)
    }

    function playAll() {
        top.playQueue.onPlay(mediaDir.id);
    }

    function playRandom() {
        top.playQueue.onPlayRandom(mediaDir.id, 40);
    }

    function addAll() {
        top.playQueue.onAdd(mediaDir.id);
    }

    function playSimilar() {
        top.playQueue.onPlaySimilar(mediaDir.id, 50);
    }

    function toggleComment() {
        $("#commentForm").toggle();
        $("#comment").toggle();
    }

    /** Albums Only **/
    // actionSelected() is invoked when the users selects from the "More actions..." combo box.
    function actionSelected(id) {
        var selectedIndexes;
        if (id == "top") {
            return;
        } else if (id == "selectAll") {
            selectAll(true);
        } else if (id == "selectNone") {
            selectAll(false);
        } else if ((selectedIndexes = getSelectedIndexes()).length > 0 && id == "star") {
            onStar(filesTable, selectedIndexes, true);
        } else if (id == "unstar" && selectedIndexes.length > 0) {
            onStar(filesTable, selectedIndexes, false);
        } else if (id == "share" && selectedIndexes.length > 0) {
            location.href = "createShare.view?id=" + mediaDir.id  + "&" + querize(selectedIndexes, "i");
        } else if (id == "download" && selectedIndexes.length > 0) {
            location.href = "download.view?id=" + mediaDir.id  + "&" + querize(selectedIndexes, "i");
        } else if (id == "appendPlaylist" && selectedIndexes.length > 0) {
            onAppendPlaylist();
        }
        $("#moreActions").prop("selectedIndex", 0);
    }

    function getSelectedIndexes() {
        return filesTable.rows({ selected: true }).indexes().toArray();
    }

    function querize(arr, queryVar) {
        return arr.map(i => queryVar + "=" + i).join("&");
    }

    function selectAll(b) {
        if (b) {
            filesTable.rows().select();
        } else {
            filesTable.rows().deselect();
        }
    }
    // need to keep track if a request was sent because plaQueue may also send a request
    var awaitingAppendPlaylistRequest = false;
    function onAppendPlaylist() {
        awaitingAppendPlaylistRequest = true;
        // retrieve writable lists so we can open dialog to ask user which playlist to append to
        top.StompClient.send("/app/playlists/writable", "");
    }
    function playlistSelectionCallback(playlists) {
        if (!awaitingAppendPlaylistRequest) {
            return;
        }
        awaitingAppendPlaylistRequest = false;
        $("#dialog-select-playlist-list").empty();
        for (var i = 0; i < playlists.length; i++) {
            var playlist = playlists[i];
            $("<p>").addClass("dense").append(
                  [
                    $("<input>").attr("type", "checkbox").attr("id", "plsel" + playlist.id).attr("name", "playlistid").attr("value", playlist.id),
                    $("<label>").attr("for", "plsel" + playlist.id).text(playlist.name).css("font-weight", "bold").css("margin-left", "1em")
                  ])
                .appendTo("#dialog-select-playlist-list");
        }
        $("#dialog-select-playlist").dialog("open");
    }
    function appendPlaylists() {
        var pl = this;
        $("#dialog-select-playlist").dialog("close");

        var mediaFileIds = filesTable.rows({selected:true}).data().map(d => d.id).toArray();

        $("#dialog-select-playlist-list input:checked").each((i, e) => pl.appendPlaylist(e.value, mediaFileIds));
    }
    function appendPlaylist(playlistId, mediaFileIds) {
        top.StompClient.send("/app/playlists/files/append", JSON.stringify({id: playlistId, modifierIds: mediaFileIds}));
    }

    /** Artists Only **/
    function playAllTopSongs() {
        top.playQueue.onPlayTopSong(mediaDir.id);
    }
    function playTopSong(index) {
        top.playQueue.onPlayTopSong(mediaDir.id, index);
    }

    /** Videos Only **/
    var videoPreview = {
        image: null,
        id: null,
        duration: null,
        timer: null,
        offset: null,
        step: null,
        size: 120
    };

    function startPreview(img, id, duration) {
        stopPreview();
        videoPreview.image = $(img);
        videoPreview.step = Math.max(5, Math.round(duration / 50));
        videoPreview.offset = videoPreview.step;
        videoPreview.id = id;
        videoPreview.duration = duration;
        updatePreview();
        videoPreview.timer = window.setInterval(updatePreview, 1000);
    }

    function updatePreview() {
        videoPreview.image.attr("src", "coverArt.view?id=" + videoPreview.id + "&size=" + videoPreview.size + "&offset=" + videoPreview.offset);
        videoPreview.offset += videoPreview.step;
        if (videoPreview.offset > videoPreview.duration) {
            stopPreview();
        }
    }

    function stopPreview() {
        if (videoPreview.timer != null) {
            window.clearInterval(videoPreview.timer);
            videoPreview.timer = null;
        }
        if (videoPreview.image != null) {
            videoPreview.image.attr("src", "coverArt.view?id=" + videoPreview.id + "&size=" + videoPreview.size);
        }
    }

    function editTagsPage() {
        window.location = "editTags.view?id=" + mediaDir.id;
    }

    function downloadAll() {
        location.href = "download.view?id=" + mediaDir.id;
    }

    function shareAlbum() {
        location.href = "createShare.view?id=" + mediaDir.id;
    }

    function searchExternally(vendor) {
        var url = null;
        switch(vendor) {
            case "google":
                url = 'https://www.google.com/search?q=' + encodeURIComponent('"' + mediaDir.artist + '" "' + mediaDir.album + '"');
                break;
            case "wikipedia":
                url = 'https://en.wikipedia.org/wiki/Special:Search?go=Go&search=' + encodeURIComponent('"' + mediaDir.album + '"');
                break;
            case "allmusic":
                url = 'https://www.allmusic.com/search/albums/' + encodeURIComponent('"' + mediaDir.artist + '" "' + mediaDir.album + '"');
                break;
            case "lastfm":
                url = 'https://www.last.fm/search?type=album&q=' + encodeURIComponent('"' + mediaDir.artist + '" "' + mediaDir.album + '"');
                break;
            case "discogs":
                url = 'https://www.discogs.com/search/?type=release&q=' + encodeURIComponent('"' + mediaDir.artist + '" "' + mediaDir.album + '"');
                break;
            case "musicbrainz":
                url = mediaDir.musicBrainzReleaseId != null ? ('https://musicbrainz.org/release/' + mediaDir.musicBrainzReleaseId) : null;
                break;
        }

        if (url != null) {
            window.open(url, '_blank', 'noopener noreferrer');
        }
    }

    function viewSelectorRefresh() {
        if (viewAsList) {
            $('#viewAsList').addClass('headerSelected').removeClass('headerNotSelected');
            $('#viewAsGrid').addClass('headerNotSelected').removeClass('headerSelected');
        } else {
            $('#viewAsGrid').addClass('headerSelected').removeClass('headerNotSelected');
            $('#viewAsList').addClass('headerNotSelected').removeClass('headerSelected');
        }
    }

    function setViewAsList(view) {
        if (view != viewAsList) {
            top.StompClient.send("/app/settings/viewAsList", view);
            viewChangedCallback(view);
        }
    }
    function viewChangedCallback(view) {
        if (view != viewAsList) {
            viewAsList = view;
            viewSelectorRefresh();
            refreshViewDependentComponents();
        }
    }
</script>
</head>
<body class="mainframe bgcolor1" onload="init();">
<div style="float:left" id="mediaInfo">
    <p id="ancestors" style="vertical-align: middle"></p>
    <p id="mediaDirTitle"></p>
    <div id="avgRating"></div>
</div>

<div style="float:right;padding-right:1em">
    <img id="viewAsList" th:src="${#themes.code('viewAsListImage')}" alt="" class="headerSelected" style="margin-right:8px" onclick="setViewAsList(true)"/>
    <img id="viewAsGrid" th:src="${#themes.code('viewAsGridImage')}" alt="" class="headerNotSelected" onclick="setViewAsList(false)"/>
</div>
<div style="clear:both"></div>
<div id="mediaDirController">
    <div style="display: inline-block">
        <span><a href="javascript:toggleMediaDirStar(!mediaDir.starred);" id="starMediaDir"></a></span>
    </div>
    <th:block th:if="${model.partyMode != true}"> 
        <div th:if="${model.user.streamRole}" class="pagetype-dependent type-album type-artist" style="display: inline-block;">
            <span><a href="javascript:playAll()"><i data-feather="play" role="img" th:aria-label="#{main.playall}" th:title="#{main.playall}"></i></a></span> 
            <span><a href="javascript:playRandom()"><i data-feather="shuffle" role="img" th:aria-label="#{main.playrandom}" th:title="#{main.playrandom}"></i></a></span>
            <span><a href="javascript:addAll()"><i data-feather="plus-square" role="img" th:aria-label="#{main.addall}" th:title="#{main.addall}"></i></a></span>
        </div>
        <div th:if="${model.user.downloadRole}" class="pagetype-dependent type-album" style="display: inline-block;">
            <span><a href="javascript:downloadAll()"><i data-feather="download" role="img" th:aria-label="#{main.downloadall}" th:title="#{main.downloadall}"></i></a></span>
        </div>

        <div th:if="${model.user.coverArtRole}" class="pagetype-dependent type-album" style="display: inline-block;">
            <span><a href="javascript:editTagsPage()"><i data-feather="edit" role="img" th:aria-label="#{main.tags}" th:title="#{main.tags}"></i></a></span>
        </div>

        <span th:if="${model.user.commentRole}"><a href="javascript:toggleComment()"><i data-feather="message-square" role="img" th:aria-label="#{main.comment}" th:title="#{main.comment}"></i></a></span>
    </th:block>
    <div th:if=${model.user.shareRole} class="detail pagetype-dependent type-album" style="display: inline-block;">
        <span><a href="javascript:shareAlbum()"><i data-feather="share-2" role="img" th:aria-label="#{main.sharealbum}" th:title=#{main.sharealbum}></i></a></span>
    </div>
</div>

<div class="detail pagetype-dependent type-album">
    <div th:if="${model.user.commentRole}" id="userRating" style="display: inline-block;"></div>
    <span class="header external-search"><span th:text="#{top.search}"></span>: <a href="#" onclick="searchExternally('google')">Google</a> |</span>
    <span class="header external-search"><a href="#" onclick="searchExternally('wikipedia')">Wikipedia</a> |</span>
    <span class="header external-search"><a href="#" onclick="searchExternally('allmusic')">allmusic</a> |</span>
    <span class="header external-search"><a href="#" onclick="searchExternally('lastfm')">Last.fm</a> |</span>
    <span class="header external-search"><a href="#" onclick="searchExternally('discogs')">Discogs</a> |</span>
    <span class="header external-search musicbrainz"><a href="#" onclick="searchExternally('musicbrainz')">MusicBrainz</a> |</span>
</div>

<div id="playCountData" class="detail pagetype-dependent type-album"></div>

<div id="comment" class="albumComment"></div>

<div id="commentForm" style="display:none">
    <form method="post" th:action="@{/setMusicFileInfo}">
        <input type="hidden" name="action" value="comment">
        <input type="hidden" id="commentFormId" name="id" value="">
        <textarea name="comment" rows="6" cols="70"></textarea>
        <input type="submit" th:value="#{common.save}">
    </form>
</div>

<div class="tableSpacer"></div>

<table id="filesTable" class="music indent hover nowrap stripe compact" th:classappend="${model.visibility.headerVisible != true?'hide-table-header':''}" style="width: 100%;">
</table>

<select id="moreActions" class="pagetype-dependent type-album type-video" onchange="actionSelected(this.options[selectedIndex].id);" style="margin-bottom:1.0em">
    <option id="top" selected="selected" th:text="#{main.more.selection}"></option>
    <option id="selectAll" th:text="|&nbsp;&nbsp;#{playlist.more.selectall}|"></option>
    <option id="selectNone" th:text="|&nbsp;&nbsp;#{playlist.more.selectnone}|"></option>
    <option th:if="${model.user.downloadRole}" id="download" th:text="|&nbsp;&nbsp;#{common.download}|"></option>
    <option th:if="${model.user.shareRole}" id="share" th:text="|&nbsp;&nbsp;#{main.more.share}|">&nbsp;&nbsp;</option>
    <option id="appendPlaylist" th:text="|&nbsp;&nbsp;#{playlist.append}|">&nbsp;&nbsp;</option>
    <option id="star" th:text="|&nbsp;&nbsp;#{playlist.more.star}|"></option>
    <option id="unstar" th:text="|&nbsp;&nbsp;#{playlist.more.unstar}|"></option>
</select>

<div class="tableSpacer"></div>

<div style="display: flex; flex-flow: row wrap;">
    <div id="mediaDirThumb" class="albumThumb pagetype-dependent type-album"></div>
    <table id="subDirsTable" class="music indent hover nowrap stripe compact hide-table-header" style="width: 100%;"></table>
</div>

<div class="tableSpacer"></div>

<div id="thumbs"></div>

<table id="artistInfoTable" style="padding:2em;clear:both" class="bgcolor2 dropshadow pagetype-dependent type-album type-artist">
    <tr class="pagetype-dependent type-artist">
        <td rowspan="5" style="vertical-align: top">
            <a id="artistImageZoom" rel="zoom" href="#">
                <img id="artistImage" class="dropshadow" alt="" style="margin-right:2em; max-width:300px; max-height:300px">
            </a>
        </td>
        <td id="artistTitle" style="text-align:center"><h2></h2></td>
    </tr>
    <tr class="pagetype-dependent type-artist">
        <td id="artistBio" style="padding-bottom: 0.5em"></td>
    </tr>
    <tr id="similarArtistsContainer" class="pagetype-dependent type-album type-artist"><td style="padding-bottom: 0.5em">
        <span style="padding-right: 0.5em; display: none" th:text="|#{main.similarartists}:|"></span>
        <span id="similarArtists"></span>
    </td></tr>
    <tr><td style="text-align:center">
        <div>
            <div class="pagetype-dependent type-album type-artist" style="display: inline-block"><button id="similarArtistsRadio" style="margin-top:1em;margin-right:0.3em;cursor:pointer" onclick="playSimilar()" th:text="#{main.startradio}"></button></div>
            <div class="pagetype-dependent type-artist" style="display: inline-block"><button id="playTopSongs" style="margin-top:1em;margin-left:0.3em;cursor:pointer" onclick="playAllTopSongs()" th:text="#{main.playtopsongs}"></button></div>
        </div>
    </td></tr>
    <tr><td style="height: 100%"></td></tr>
</table>

<table id="artistTopSongsTable" class="music indent hover nowrap stripe compact hide-table-header" style="width: 100%;">
</table>

<div id="dialog-select-playlist" th:title="#{playlist.append}" style="display: none;">
    <p th:text="#{main.addtoplaylist.text}"></p>
    <div id="dialog-select-playlist-list"></div>
</div>
</body>
</html>
